---
- name: configure networking
  tags: ['net']
  block:

    - name: configure iwd
      tags: ['iwd']
      block:
        - name: copy iwd main config
          copy: src=net/iwd/main.conf dest=/etc/iwd/main.conf

        - name: enable iwd service
          service: name=iwd enabled=yes state=started

        - name: copy iwd configs
          copy: src="{{ priv_dir }}/iwd/" dest=/var/lib/iwd/
          notify: restart iwd


    - name: networkd
      tags: ['systemd', 'systemd-networkd']
      block:

        - name: enable networkd
          service: name=systemd-networkd enabled=yes state=started

        - name: copy networkd configs
          copy: src=net/networkd/ dest=/
          notify: restart systemd-networkd

    - name: resolved
      tags: ['systemd', 'systemd-resolved']
      block:

        - name: symlink resolv.conf stub
          file:
            src: "/run/systemd/resolve/stub-resolv.conf"
            dest: "/etc/resolv.conf"
            state: link

        - name: enable systemd-resolved
          service: name=systemd-resolved enabled=yes state=started

        - name: copy resolved configs
          copy: src=net/resolved/ dest=/
          notify: restart systemd-resolved
