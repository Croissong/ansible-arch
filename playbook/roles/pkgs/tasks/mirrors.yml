---
- name: pkg repo mirrors
  tags: ['maintenance', 'mirrors']
  block:
    - include_tasks: util__mirrorlist_checksum.yml
      vars:
        register_var: mirrorlist_pre

    - name: update repository mirrors
      command: |
        reflector --sort score -p https --country '{{ country }}' --save /etc/pacman.d/mirrorlist
      changed_when: false

    - include_tasks: util__mirrorlist_checksum.yml
      vars:
        register_var: mirrorlist_post

    - name: compare mirrorlist checksums
      debug: msg="mirrorlist changed"
      changed_when: True
      when: mirrorlist_pre.stat.checksum != mirrorlist_post.stat.checksum
